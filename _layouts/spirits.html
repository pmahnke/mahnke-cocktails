---
layout: default
---

{%- assign target_spirit = page.spirit_name | strip -%}

{%- comment -%} 
  1. Filter all site pages to find recipes that contain the target spirit.
  2. The result is stored in 'filtered_cocktails'.
{%- endcomment -%}
{%- assign filtered_cocktails = "" | split: " " -%}
{%- assign cocktails_found = 0 -%}

{%- for cocktail in site.pages -%}
  {%- comment -%} Ensure we only look at recipe pages with a spirits list {%- endcomment -%}
  {%- if cocktail.layout == 'recipe' and cocktail.base_spirits -%}
    {%- if cocktail.base_spirits contains target_spirit -%}
      {%- assign filtered_cocktails = filtered_cocktails | push: cocktail -%}
      {%- assign cocktails_found = cocktails_found | plus: 1 -%}
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

<div class="grid-container two-thirds">
    <div><!-- div 2/3 (Main Content) -->

        {%- comment -%} 
          Display the title and optional description from the spirit/ file's front matter 
        {%- endcomment -%}
        <h2>{{ page.title }}</h2>
        {%- if page.description -%}
            <p>{{ page.description }}</p>
        {%- endif -%}
        
        <p class="text-sm text-gray-500 mb-4">Found {{ cocktails_found }} recipe{% if cocktails_found != 1 %}s{% endif %} featuring {{ target_spirit }}.</p>
        
        {%- comment -%} FIX: Assign sorted list to a new variable before looping, as filters are not allowed directly in the 'for' tag. {%- endcomment -%}
        {%- assign sorted_cocktails = filtered_cocktails | sort: 'title' -%}
        
        <table class="home_table">
        {%- for page in sorted_cocktails -%}
        <tr>
            <th class="home_title">
                <a href="{{ page.url | prepend: site.baseurl }}">
                    {{ page.title }}
                </a>
            </th>
            <td class="home_spirits">
                {%- include category_search.html -%} 
            </td>
            <td class="home_stars">
                {%- comment -%} Assuming 'stars.html' reads 'page.stars' {%- endcomment -%}
                {%- include stars.html -%}
            </td>
        </tr>
        {%- endfor -%}
        </table>
    </div><!-- /div 2/3-->
    
    <div>

        {%- if page.image -%}<img src="{{ page.image }}" alt="{{ page.title }}" class="category_icon_large">{%- endif -%}

    </div><!-- empty div 1/3 (Sidebar) -->
</div><!-- /div grid-container -->
